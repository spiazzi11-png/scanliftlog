<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ScanLiftLog</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background:#f6f7f8; color:#111; }
    header { padding: 18px 18px 10px; background: #fff; border-bottom: 1px solid #e6e6e6; }
    .wrap { max-width: 860px; margin: 0 auto; }
    h1 { font-size: 20px; margin: 0 0 8px; }
    .sub { font-size: 13px; color: #444; }
    main { padding: 18px; }
    .grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 14px; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }

    .card { background:#fff; border:1px solid #e6e6e6; border-radius: 14px; padding: 14px; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
    .row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    label { font-size: 12px; color:#333; }
    input, select, textarea {
      width: 100%;
      padding: 10px 10px;
      border: 1px solid #d8d8d8;
      border-radius: 10px;
      font-size: 14px;
      background: #fff;
      box-sizing: border-box;
    }
    textarea { min-height: 80px; resize: vertical; }

    .btn {
      appearance: none;
      border: 1px solid #0b5;
      background: #0b5;
      color: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 600;
      cursor: pointer;
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .btn.secondary { border-color:#d8d8d8; background:#fff; color:#111; }
    .btn.danger { border-color:#d33; background:#d33; color:#fff; }
    .btn:disabled { opacity: .55; cursor: not-allowed; }

    .pill { display:inline-flex; padding: 4px 9px; border-radius: 999px; font-size: 12px; border:1px solid #e0e0e0; background:#fafafa; color:#333; }
    .muted { color:#666; font-size: 13px; }
    .kpi { display:flex; gap:10px; flex-wrap: wrap; margin-top: 10px; }
    .kpi .pill strong { margin-left: 6px; }

    .history { margin-top: 10px; }
    .hist-item {
      border: 1px solid #ededed;
      border-radius: 12px;
      padding: 10px;
      margin-top: 8px;
      background:#fcfcfc;
    }
    .hist-top { display:flex; justify-content: space-between; gap: 10px; }
    .hist-date { font-weight: 700; font-size: 13px; }
    .hist-summary { font-size: 13px; color:#333; margin-top: 6px; white-space: pre-wrap; }
    .small { font-size: 12px; color:#666; }

    .setrow { display:grid; grid-template-columns: 1fr 1fr 54px; gap: 10px; align-items:end; }
    .setrow .btn { justify-content:center; padding: 10px 10px; }
    .divider { height:1px; background:#ededed; margin: 12px 0; }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px;
      background: #111; color:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
      max-width: calc(100vw - 24px);
      font-size: 13px;
    }
    .toast.show { opacity: 0.92; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ScanLiftLog</h1>
      <div class="sub">
        QR → Machine Page → Log Sets/Reps/Weight → View Your History (no login). Identity is stored on this device via <code>localStorage</code>.
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card">
        <div class="row" style="justify-content: space-between;">
          <div>
            <div class="pill" id="machinePill">Machine</div>
            <div class="pill" id="userPill" title="Anonymous per-device ID">User</div>
          </div>
          <div class="row">
            <button class="btn secondary" id="resetUserBtn" title="Creates a new anonymous user on this device">Reset User</button>
          </div>
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px; font-size:16px;">Your last workout on this machine</h2>
        <div class="muted" id="lastWorkoutText">None yet. Log your first session below.</div>

        <div class="kpi" id="kpis" style="display:none;">
          <span class="pill">Last Weight <strong id="kpiWeight"></strong></span>
          <span class="pill">Last Volume <strong id="kpiVolume"></strong></span>
          <span class="pill">Workouts Logged <strong id="kpiCount"></strong></span>
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px; font-size:16px;">Log today’s workout</h2>

        <div id="sets"></div>

        <div class="row" style="margin-top:10px;">
          <button class="btn secondary" id="addSetBtn">+ Add Set</button>
          <button class="btn" id="saveBtn">Save Workout</button>
          <button class="btn danger" id="clearMachineBtn" title="Deletes history for this machine for this user only">Clear This Machine History</button>
        </div>

        <div style="margin-top:10px;">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" placeholder="e.g., felt strong, slow tempo, drop set on last set"></textarea>
        </div>

        <div class="divider"></div>

        <div class="small">
          Tip: to simulate scanning different machines, add <code>?machine=LEGPR-002</code> or <code>?machine=SHPR-001</code> to the URL.
        </div>
      </section>

      <aside class="card">
        <h2 style="margin:0 0 8px; font-size:16px;">History (this machine)</h2>
        <div class="muted" id="histHint">Your saved sessions appear here for this machine.</div>
        <div class="history" id="history"></div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px; font-size:16px;">How the “unique user” works</h2>
        <div class="small">
          On first load, the page generates an anonymous ID and stores it on this device:
          <ul>
            <li><code>anon_user_id</code> in <code>localStorage</code></li>
            <li>Every log is saved under <code>(user_id, machine_id)</code></li>
          </ul>
          If you open this page in a different browser/device, it becomes a different “user” unless you later add account signup.
        </div>
      </aside>
    </div>
  </main>

  <div class="toast" id="toast"></div>

<script>
(function(){
  // ---------- Helpers ----------
  function uuidv4() {
    // RFC4122-ish, good enough for demo (use crypto UUID in production)
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  function toast(msg){
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 1800);
  }

  function getQueryParam(key){
    const params = new URLSearchParams(window.location.search);
    return params.get(key);
  }

  // ---------- Identity ----------
  function getOrCreateUserId(){
    let id = localStorage.getItem('anon_user_id');
    if(!id){
      id = uuidv4();
      localStorage.setItem('anon_user_id', id);
    }
    return id;
  }

  function resetUser(){
    localStorage.removeItem('anon_user_id');
    window.location.reload();
  }

  // ---------- Storage ----------
  function storageKey(userId, machineId){
    return `logs:${userId}:${machineId}`;
  }

  function loadLogs(userId, machineId){
    const raw = localStorage.getItem(storageKey(userId, machineId));
    if(!raw) return [];
    try { return JSON.parse(raw); } catch(e){ return []; }
  }

  function saveLogs(userId, machineId, logs){
    localStorage.setItem(storageKey(userId, machineId), JSON.stringify(logs));
  }

  function clearMachineHistory(userId, machineId){
    localStorage.removeItem(storageKey(userId, machineId));
  }

  // ---------- UI State ----------
  const userId = getOrCreateUserId();
  const machineId = (getQueryParam('machine') || 'SHPR-001')
  .trim()
  .toUpperCase();


  const MACHINE_MAP = {
    // ---- Chest ----
    "CHPR-001": "Flat Chest Press — Machine 1",
    "CHPR-002": "Flat Chest Press — Machine 2",
    "CHPR-003": "Flat Chest Press — Machine 3",

    "INCHPR-001": "Incline Chest Press — Machine 1",
    "INCHPR-002": "Incline Chest Press — Machine 2",
    "INCHPR-003": "Incline Chest Press — Machine 3",

    "DECHPR-001": "Decline Chest Press — Machine 1",
    "DECHPR-002": "Decline Chest Press — Machine 2",
    "DECHPR-003": "Decline Chest Press — Machine 3",

    "PECDK-001": "Pec Deck / Chest Fly — Machine 1",
    "PECDK-002": "Pec Deck / Chest Fly — Machine 2",
    "PECDK-003": "Pec Deck / Chest Fly — Machine 3",

    "CABFLY-001": "Cable Fly (Chest) — Station 1",
    "CABFLY-002": "Cable Fly (Chest) — Station 2",
    "CABFLY-003": "Cable Fly (Chest) — Station 3",

    "SMTH-001": "Smith Machine — Rack 1",
    "SMTH-002": "Smith Machine — Rack 2",
    "SMTH-003": "Smith Machine — Rack 3",

    // ---- Shoulders ----
    "SHPR-001": "Shoulder Press — Machine 1",
    "SHPR-002": "Shoulder Press — Machine 2",
    "SHPR-003": "Shoulder Press — Machine 3",

    "LATRL-001": "Lateral Raise — Machine 1",
    "LATRL-002": "Lateral Raise — Machine 2",
    "LATRL-003": "Lateral Raise — Machine 3",

    "RDLT-001": "Rear Delt Fly — Machine 1",
    "RDLT-002": "Rear Delt Fly — Machine 2",
    "RDLT-003": "Rear Delt Fly — Machine 3",

    "UPROW-001": "Upright Row — Machine 1",
    "UPROW-002": "Upright Row — Machine 2",
    "UPROW-003": "Upright Row — Machine 3",

    // ---- Back ----
    "LATPD-001": "Lat Pulldown — Station 1",
    "LATPD-002": "Lat Pulldown — Station 2",
    "LATPD-003": "Lat Pulldown — Station 3",

    "SETRW-001": "Seated Row — Machine 1",
    "SETRW-002": "Seated Row — Machine 2",
    "SETRW-003": "Seated Row — Machine 3",

    "HIRW-001": "High Row — Machine 1",
    "HIRW-002": "High Row — Machine 2",
    "HIRW-003": "High Row — Machine 3",

    "ASSTPD-001": "Assisted Pull-Up / Dip — Station 1",
    "ASSTPD-002": "Assisted Pull-Up / Dip — Station 2",
    "ASSTPD-003": "Assisted Pull-Up / Dip — Station 3",

    "STRPD-001": "Straight-Arm Pulldown — Station 1",
    "STRPD-002": "Straight-Arm Pulldown — Station 2",
    "STRPD-003": "Straight-Arm Pulldown — Station 3",

    "BKEXT-001": "Back Extension — Station 1",
    "BKEXT-002": "Back Extension — Station 2",
    "BKEXT-003": "Back Extension — Station 3",

    // ---- Legs ----
    "LEGPR-001": "Leg Press — Machine 1",
    "LEGPR-002": "Leg Press — Machine 2",
    "LEGPR-003": "Leg Press — Machine 3",

    "HKSQ-001": "Hack Squat — Machine 1",
    "HKSQ-002": "Hack Squat — Machine 2",
    "HKSQ-003": "Hack Squat — Machine 3",

    "SQMT-001": "Squat Machine — Machine 1",
    "SQMT-002": "Squat Machine — Machine 2",
    "SQMT-003": "Squat Machine — Machine 3",

    "LEGEX-001": "Leg Extension — Machine 1",
    "LEGEX-002": "Leg Extension — Machine 2",
    "LEGEX-003": "Leg Extension — Machine 3",

    "SLCUR-001": "Seated Leg Curl — Machine 1",
    "SLCUR-002": "Seated Leg Curl — Machine 2",
    "SLCUR-003": "Seated Leg Curl — Machine 3",

    "LLCUR-001": "Lying Leg Curl — Machine 1",
    "LLCUR-002": "Lying Leg Curl — Machine 2",
    "LLCUR-003": "Lying Leg Curl — Machine 3",

    "STCUR-001": "Standing Leg Curl — Machine 1",
    "STCUR-002": "Standing Leg Curl — Machine 2",
    "STCUR-003": "Standing Leg Curl — Machine 3",

    "HIPAB-001": "Hip Abductor — Machine 1",
    "HIPAB-002": "Hip Abductor — Machine 2",
    "HIPAB-003": "Hip Abductor — Machine 3",

    "HIPAD-001": "Hip Adductor — Machine 1",
    "HIPAD-002": "Hip Adductor — Machine 2",
    "HIPAD-003": "Hip Adductor — Machine 3",

    "GLUTKB-001": "Glute Kickback — Machine 1",
    "GLUTKB-002": "Glute Kickback — Machine 2",
    "GLUTKB-003": "Glute Kickback — Machine 3",

    "SCALF-001": "Seated Calf Raise — Machine 1",
    "SCALF-002": "Seated Calf Raise — Machine 2",
    "SCALF-003": "Seated Calf Raise — Machine 3",

    "STCALF-001": "Standing Calf Raise — Machine 1",
    "STCALF-002": "Standing Calf Raise — Machine 2",
    "STCALF-003": "Standing Calf Raise — Machine 3",

    // ---- Arms ----
    "PRCUR-001": "Preacher Curl — Machine 1",
    "PRCUR-002": "Preacher Curl — Machine 2",
    "PRCUR-003": "Preacher Curl — Machine 3",

    "BICUR-001": "Biceps Curl — Machine 1",
    "BICUR-002": "Biceps Curl — Machine 2",
    "BICUR-003": "Biceps Curl — Machine 3",

    "CABCRL-001": "Cable Curl — Station 1",
    "CABCRL-002": "Cable Curl — Station 2",
    "CABCRL-003": "Cable Curl — Station 3",

    "TRIEX-001": "Triceps Extension — Machine 1",
    "TRIEX-002": "Triceps Extension — Machine 2",
    "TRIEX-003": "Triceps Extension — Machine 3",

    "DIPMT-001": "Dip Machine — Machine 1",
    "DIPMT-002": "Dip Machine — Machine 2",
    "DIPMT-003": "Dip Machine — Machine 3",

    "CABPD-001": "Cable Pushdown — Station 1",
    "CABPD-002": "Cable Pushdown — Station 2",
    "CABPD-003": "Cable Pushdown — Station 3",

    // ---- Core / Abs ----
    "ABCR-001": "Ab Crunch — Machine 1",
    "ABCR-002": "Ab Crunch — Machine 2",
    "ABCR-003": "Ab Crunch — Machine 3",

    "RTTOR-001": "Rotary Torso — Machine 1",
    "RTTOR-002": "Rotary Torso — Machine 2",
    "RTTOR-003": "Rotary Torso — Machine 3",

    "CAPCH-001": "Captain’s Chair — Station 1",
    "CAPCH-002": "Captain’s Chair — Station 2",
    "CAPCH-003": "Captain’s Chair — Station 3",

    "DABEN-001": "Decline Ab Bench — Bench 1",
    "DABEN-002": "Decline Ab Bench — Bench 2",
    "DABEN-003": "Decline Ab Bench — Bench 3",

    "CABAB-001": "Cable Crunch — Station 1",
    "CABAB-002": "Cable Crunch — Station 2",
    "CABAB-003": "Cable Crunch — Station 3",

    // ---- Free Weights / Racks / Benches ----
    "FBEN-001": "Flat Bench — Bench 1",
    "FBEN-002": "Flat Bench — Bench 2",
    "FBEN-003": "Flat Bench — Bench 3",

    "IBEN-001": "Incline Bench — Bench 1",
    "IBEN-002": "Incline Bench — Bench 2",
    "IBEN-003": "Incline Bench — Bench 3",

    "DBEN-001": "Decline Bench — Bench 1",
    "DBEN-002": "Decline Bench — Bench 2",
    "DBEN-003": "Decline Bench — Bench 3",

    "SQRK-001": "Squat Rack — Rack 1",
    "SQRK-002": "Squat Rack — Rack 2",
    "SQRK-003": "Squat Rack — Rack 3",

    "PWRK-001": "Power Rack — Rack 1",
    "PWRK-002": "Power Rack — Rack 2",
    "PWRK-003": "Power Rack — Rack 3",

    "DBRCK-001": "Dumbbell Rack — Area 1",
    "DBRCK-002": "Dumbbell Rack — Area 2",
    "DBRCK-003": "Dumbbell Rack — Area 3",

    // ---- Cardio (optional) ----
    "TRED-001": "Treadmill — Unit 1",
    "TRED-002": "Treadmill — Unit 2",
    "TRED-003": "Treadmill — Unit 3",

    "ELIP-001": "Elliptical — Unit 1",
    "ELIP-002": "Elliptical — Unit 2",
    "ELIP-003": "Elliptical — Unit 3",

    "STAIR-001": "Stair Climber — Unit 1",
    "STAIR-002": "Stair Climber — Unit 2",
    "STAIR-003": "Stair Climber — Unit 3",

    "BIKE-001": "Stationary Bike — Unit 1",
    "BIKE-002": "Stationary Bike — Unit 2",
    "BIKE-003": "Stationary Bike — Unit 3",

    "ROW-001": "Rower — Unit 1",
    "ROW-002": "Rower — Unit 2",
    "ROW-003": "Rower — Unit 3"
  };
  const machineName = MACHINE_MAP[machineId] || `Machine (${machineId})`;

  document.getElementById('machinePill').textContent = machineName;
  document.getElementById('userPill').textContent = `User: ${userId.slice(0,8)}…`;

  document.getElementById('resetUserBtn').addEventListener('click', resetUser);

  // ---------- Sets UI ----------
  const setsDiv = document.getElementById('sets');

  function makeSetRow(setNumber, reps='', weight=''){
    const row = document.createElement('div');
    row.className = 'setrow';
    row.style.marginTop = '10px';

    const repsWrap = document.createElement('div');
    const repsLab = document.createElement('label');
    repsLab.textContent = `Set ${setNumber} – Reps`;
    const repsInp = document.createElement('input');
    repsInp.type = 'number';
    repsInp.min = '0';
    repsInp.placeholder = 'e.g., 10';
    repsInp.value = reps;
    repsWrap.appendChild(repsLab);
    repsWrap.appendChild(repsInp);

    const wtWrap = document.createElement('div');
    const wtLab = document.createElement('label');
    wtLab.textContent = `Set ${setNumber} – Weight (lb)`;
    const wtInp = document.createElement('input');
    wtInp.type = 'number';
    wtInp.min = '0';
    wtInp.step = '0.5';
    wtInp.placeholder = 'e.g., 135';
    wtInp.value = weight;
    wtWrap.appendChild(wtLab);
    wtWrap.appendChild(wtInp);

    const delBtn = document.createElement('button');
    delBtn.className = 'btn secondary';
    delBtn.type = 'button';
    delBtn.textContent = '✕';
    delBtn.title = 'Remove set';
    delBtn.addEventListener('click', () => {
      row.remove();
      renumberSets();
    });

    row.appendChild(repsWrap);
    row.appendChild(wtWrap);
    row.appendChild(delBtn);

    return row;
  }

  function renumberSets(){
    const rows = [...setsDiv.querySelectorAll('.setrow')];
    rows.forEach((row, idx) => {
      const setNum = idx + 1;
      const labels = row.querySelectorAll('label');
      labels[0].textContent = `Set ${setNum} – Reps`;
      labels[1].textContent = `Set ${setNum} – Weight (lb)`;
    });
  }

  function addSet(reps='', weight=''){
    const current = setsDiv.querySelectorAll('.setrow').length;
    setsDiv.appendChild(makeSetRow(current + 1, reps, weight));
  }

  document.getElementById('addSetBtn').addEventListener('click', () => addSet());

  // default sets
  addSet();
  addSet();
  addSet();

  // ---------- History Rendering ----------
  function calcVolume(sets){
    // volume = sum(reps * weight)
    return sets.reduce((sum, s) => sum + (Number(s.reps)||0) * (Number(s.weight)||0), 0);
  }

  function formatSummary(log){
    const lines = log.sets.map((s, i) => `Set ${i+1}: ${s.reps} reps @ ${s.weight} lb`);
    if(log.notes && log.notes.trim()) lines.push(`Notes: ${log.notes.trim()}`);
    return lines.join('\n');
  }

  function render(history){
    const last = history[0];
    const lastText = document.getElementById('lastWorkoutText');
    const kpis = document.getElementById('kpis');

    if(!last){
      lastText.textContent = 'None yet. Log your first session below.';
      kpis.style.display = 'none';
    } else {
      lastText.textContent = `${new Date(last.ts).toLocaleString()} — ${last.sets.length} set(s)`;
      kpis.style.display = 'flex';
      const lastWeight = last.sets.length ? Math.max(...last.sets.map(s => Number(s.weight)||0)) : 0;
      document.getElementById('kpiWeight').textContent = `${lastWeight} lb`;
      document.getElementById('kpiVolume').textContent = `${calcVolume(last.sets).toLocaleString()} lb·reps`;
      document.getElementById('kpiCount').textContent = `${history.length}`;
    }

    const histDiv = document.getElementById('history');
    histDiv.innerHTML = '';
    if(history.length === 0){
      document.getElementById('histHint').textContent = 'Your saved sessions appear here for this machine.';
      return;
    }
    document.getElementById('histHint').textContent = '';

    history.forEach((log, idx) => {
      const item = document.createElement('div');
      item.className = 'hist-item';

      const top = document.createElement('div');
      top.className = 'hist-top';

      const date = document.createElement('div');
      date.className = 'hist-date';
      date.textContent = new Date(log.ts).toLocaleString();

      const actions = document.createElement('div');
      actions.className = 'small';
      actions.innerHTML = `<button class="btn secondary" style="padding:6px 10px; border-radius:10px;" data-idx="${idx}">Load</button>`;

      top.appendChild(date);
      top.appendChild(actions);

      const summary = document.createElement('div');
      summary.className = 'hist-summary';
      summary.textContent = formatSummary(log);

      item.appendChild(top);
      item.appendChild(summary);
      histDiv.appendChild(item);
    });

    // bind load buttons
    histDiv.querySelectorAll('button[data-idx]').forEach(btn => {
      btn.addEventListener('click', () => {
        const idx = Number(btn.getAttribute('data-idx'));
        const log = history[idx];
        // load sets into form
        setsDiv.innerHTML = '';
        log.sets.forEach(s => addSet(String(s.reps||''), String(s.weight||'')));
        document.getElementById('notes').value = log.notes || '';
        toast('Loaded workout into editor.');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });
  }

  function refresh(){
    const history = loadLogs(userId, machineId);
    render(history);
  }

  // ---------- Save ----------
  document.getElementById('saveBtn').addEventListener('click', () => {
    const rows = [...setsDiv.querySelectorAll('.setrow')];
    const sets = rows.map(row => {
      const inputs = row.querySelectorAll('input');
      return { reps: Number(inputs[0].value), weight: Number(inputs[1].value) };
    }).filter(s => (s.reps && s.reps > 0) || (s.weight && s.weight > 0));

    if(sets.length === 0){
      toast('Add at least one set (reps or weight).');
      return;
    }

    const notes = document.getElementById('notes').value || '';
    const history = loadLogs(userId, machineId);

    const log = { ts: Date.now(), sets, notes };
    history.unshift(log);
    saveLogs(userId, machineId, history);

    toast('Workout saved.');
    refresh();
  });

  // ---------- Clear machine ----------
  document.getElementById('clearMachineBtn').addEventListener('click', () => {
    if(!confirm('Delete ALL history for this machine (for this user on this device)?')) return;
    clearMachineHistory(userId, machineId);
    toast('Machine history cleared.');
    refresh();
  });

  // initial render
  refresh();
})();
</script>
  <footer style="
  margin-top: 40px;
  padding: 16px;
  text-align: center;
  font-size: 13px;
  color: #666;
  border-top: 1px solid #e5e5e5;
">
  © 2026 ScanLiftLog. All rights reserved.
</footer>

</body>
</html>
